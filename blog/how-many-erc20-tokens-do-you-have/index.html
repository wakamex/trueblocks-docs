<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.276eb9cb364fb39815696aa092a79c6e1a6a7975f7222d1c3c99e08ce139ea28ad47638259a8510c0199ecabfb318b626fc903002e6b91fcfa0c2cf97653b4c5.css integrity="sha512-J265yzZPs5gVaWqgkqecbhpqeXX3Ii0cPJngjOE56iitR2OCWahRDAGZ7Kv7MYtib8kDAC5rkfz6DCz5dlO0xQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>How Many ERC20 Tokens Do You Have? - TrueBlocks</title><meta name=description content="Ethereum as it was meant to be: local-first, P2P, and accurate queries to all the data you’ll ever need."><link rel=canonical href=/blog/how-many-erc20-tokens-do-you-have/><meta name=twitter:card content="https://trueblocks.io/trueblocks.png"><meta name=twitter:image content="https://trueblocks.io/trueblocks.png"><meta name=twitter:title content="How Many ERC20 Tokens Do You Have?"><meta name=twitter:description content="I was recently included in a discussion about why it’s so difficult to get ERC20 token balances (and other data) from the Ethereum blockchain. I thought I’d take a crack at answering the question.
I think it comes down to four words: “Incoming”, “Internal”, “Transactions”…and “Decentralization.” I’ll focus on each word individually.
Transaction I’ll start with the easiest word first: “Transaction.”
Go into a bagel store. Buy a dozen bagels and get a receipt."><meta name=twitter:site content="@TrueBlocks"><meta name=twitter:creator content="@TrueBlocks"><meta property="og:title" content="How Many ERC20 Tokens Do You Have?"><meta property="og:description" content="I was recently included in a discussion about why it’s so difficult to get ERC20 token balances (and other data) from the Ethereum blockchain. I thought I’d take a crack at answering the question.
I think it comes down to four words: “Incoming”, “Internal”, “Transactions”…and “Decentralization.” I’ll focus on each word individually.
Transaction I’ll start with the easiest word first: “Transaction.”
Go into a bagel store. Buy a dozen bagels and get a receipt."><meta property="og:type" content="article"><meta property="og:url" content="/blog/how-many-erc20-tokens-do-you-have/"><meta property="og:image" content="https://trueblocks.io/trueblocks.png"><meta property="article:published_time" content="2018-04-20T23:11:49+00:00"><meta property="article:modified_time" content="2023-01-08T17:12:52-05:00"><meta property="og:site_name" content="TrueBlocks"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"\/blog\/how-many-erc20-tokens-do-you-have\/"},"headline":"How Many ERC20 Tokens Do You Have?","image":[],"datePublished":"2018-04-20T23:11:49CET","dateModified":"2023-01-08T17:12:52CET","author":{"@type":"Organization","name":"TrueBlocks"},"publisher":{"@type":"Organization","name":"TrueBlocks","logo":{"@type":"ImageObject","url":"\/logo-doks.png"}},"description":""}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"\/"},{"@type":"ListItem","position":2,"name":"Bloghow Many Erc20 Tokens Do You Have","item":"\/bloghow-many-erc20-tokens-do-you-have\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="blog single"><div class="header-bar fixed-top"></div><script>(localStorage.getItem("theme")==="dark"||localStorage.getItem("theme")===null)&&document.body.classList.add("dark")</script><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label>
<a class="navbar-brand order-1 order-md-0 me-auto" href=/>TrueBlocks</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/trueblocks><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://discord.com/invite/kAFcZH2x7K><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="simple icon-discord"><path d="M20.317 4.3698a19.7913 19.7913.0 00-4.8851-1.5152.0741.0741.0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868.0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077.0 00-.0785-.037 19.7363 19.7363.0 00-4.8852 1.515.0699.0699.0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824.0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777.0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076.0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077.0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743.0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614.0a.0739.0739.0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077.0 01-.0066.1276 12.2986 12.2986.0 01-1.873.8914.0766.0766.0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076.0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077.0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061.0 00-.0312-.0286zM8.02 15.3312c-1.1825.0-2.1569-1.0857-2.1569-2.419.0-1.3332.9555-2.4189 2.157-2.4189 1.2108.0 2.1757 1.0952 2.1568 2.419.0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748.0c-1.1825.0-2.1569-1.0857-2.1569-2.419.0-1.3332.9554-2.4189 2.1569-2.4189 1.2108.0 2.1757 1.0952 2.1568 2.419.0 1.3332-.946 2.4189-2.1568 2.4189z"/></svg><span class="ms-2 visually-hidden">Discord</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/trueblocks/trueblocks-core><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li><li class=nav-item><a class=nav-link href=/api>API<span class="ms-2 visually-hidden">API</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=/docs/>Introduction</a></li><li class=nav-item><a class=nav-link href=/chifra/introduction>Chifra</a></li><li class=nav-item><a class=nav-link href=/data-model/intro>Data Model</a></li><li class=nav-item><a class=nav-link href=/explorer/introduction>Explorer</a></li><li class=nav-item><a class=nav-link href=/sdks/introduction>SDKs</a></li><li class="nav-item active"><a class=nav-link href=/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=/papers/>Papers</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-4M60J4ZGSQ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4M60J4ZGSQ",{anonymize_ip:!1})}</script></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Categories</h3><ul class=list-unstyled><li><a href=/tags/ethereum>ethereum</a> (28)</li><li><a href=/tags/trueblocks>trueblocks</a> (20)</li><li><a href=/tags/community>community</a> (6)</li><li><a href=/tags/tutorials>tutorials</a> (5)</li><li><a href=/tags/faq>faq</a> (1)</li><li><a href=/tags/trueblocks/>trueblocks</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>How Many ERC20 Tokens Do You Have?</h1><div class=date><small><em>Published on: </em>Apr 20, 2018
<em>Last edited: </em>Jan 8, 2023</small><br></p></div><p class=lead>You may never know</p><p>I was recently included <a href=https://twitter.com/ricburton/status/986459891035525120>in a discussion</a> about why it’s so difficult to get ERC20 token balances (and other data) from the Ethereum blockchain. I thought I’d take a crack at answering the question.</p><p>I think it comes down to four words: “Incoming”, “Internal”, “Transactions”…and “Decentralization.” I’ll focus on each word individually.</p><h4 id=transaction>Transaction<a href=#transaction class=anchor aria-hidden=true>#</a></h4><p>I’ll start with the easiest word first: “Transaction.”</p><p><img src=/blog/img/024-How-Many-ERC20-Tokens-Do-You-Have-001.png alt></p><p>Go into a bagel store. Buy a dozen bagels and get a receipt. Everything you need to know about your transaction is on the receipt. <code>Date</code>, <code>amount</code>, <code>sender</code> (<code>from</code>) and <code>recipient</code> (<code>to</code>). This is the same information you’ll find on every Ethereum transaction.</p><p>From your perspective (the spender), the expenditure represents outgoing money. From the perspective of the bagel shop, the transaction is incoming money and this leads to the next word on our list…</p><h4 id=incoming>Incoming<a href=#incoming class=anchor aria-hidden=true>#</a></h4><p>If you’re the <code>sender</code> of a transaction, you know that you sent it. You physically opened your wallet, you took the money out, and you handed it to the store owner. Keeping track of spending is easy. All you have to do is remember what you did. But what about keeping track of incoming money?</p><p>I hear you say, “That’s easy?” The bagel shop simply uses a cash register. It sounds simple enough. But now we bump into the next word…</p><h4 id=internal>Internal<a href=#internal class=anchor aria-hidden=true>#</a></h4><p>Every Ethereum transaction is initiated by an external account. An external account lives <em>outside of the blockchain</em>. Transactions are initiated either by a human or by a piece of software run by a human being. If you’ve used a blockchain, you’re familiar with all of this.</p><p>There has never been (will there ever be?) a transaction <em>initiated from inside</em> the blockchain. And this makes perfect sense — a transaction requires a signature with a private key. There are no private keys inside the blockchain. If there were, because the blockchain is open, I would see it and steal all of your money in a second.</p><p>So, distinguish between “external” and “internal” transactions. “Internal” transactions are transactions that follow from “external” transactions. Saying this another way, only smart contracts can initiate an “internal” transaction.</p><p>The majority of transactions on the Ethereum blockchain consist of one external account sending money (or a message) to another external account.</p><p><img src=/blog/img/024-How-Many-ERC20-Tokens-Do-You-Have-002.png alt></p><p>Many other transactions (also external) are sent from an external account to a smart contract. When you think of the transactions that are being hashed into a block, you are thinking of external transactions.</p><p><img src=/blog/img/024-How-Many-ERC20-Tokens-Do-You-Have-003.png alt></p><p>An internal transaction is a transfer of value (or a message call) that occurs as the result of a smart contract calling or sending money into other accounts.</p><p><img src=/blog/img/024-How-Many-ERC20-Tokens-Do-You-Have-004.png alt></p><p>As we saw earlier, keeping track of the “send” side of an internal transaction is simple. The smart contract itself, as it generates the call, can simply emit an event. This will alert both the sender and receiver that something has happened (for example, a token transfer or token mint happened). This is how almost all ERC20 token contract work. When someone buys a token or transfers a token, in addition to recording that fact inside the smart contract’s balance map, the smart contract emits an event. I say “most” token contracts work this way because there is no hard requirement in the ERC20 standard when tokens are minted.</p><p>Here’s a quote from the spec:</p><blockquote><p>A token contract which creates new tokens SHOULD trigger a Transfer event with the from address set to 0x0 when tokens are created.</p></blockquote><p>“SHOULD”, in EIP-speak, means that the contract doesn’t have to comply. And here you should be able to see one of the reasons why it’s so difficult to accurately account for an arbitrary ERC20 token.</p><p>Sometimes, when an ERC 20 token contract mints new tokens, it <strong>does not</strong> generate an event. This was more likely back in the day with early ERC20 token contracts, but it’s still true today.</p><p>Even when a smart contract does generate minting events, there is no standard way of doing so. Some smart contracts generate a <code>Transfer</code> event with the <code>from</code> parameter set to <code>0x0</code> as they SHOULD. Others have their own <code>Mint</code> event. Still others generate no events at all on a mint.</p><p>The fact that there is no hard standard for mint events, makes programmatically accounting for every received token impossible. This becomes especially acute in the case of airdrops, many of which create thousands (millions?) of tokens when first created. Frequently, they do not generate individual events for each minted token. It’s as if money magically appeared in your wallet or the bagel shop’s cash drawer.</p><p>Technically, an ERC20 token mint is not an “incoming internal transaction” — there’s no actual send or call into the recipient — but incoming internal transactions can have the same effect. If an event is not generated by a calling contract — and in many cases, events are not generated even when value is exchanged — the receiving account can be granted ownership of something of value without being made aware.</p><p>If the smart contracts do not generate events for value transfers, there is no way for the receiving address to know about it without watching every transaction. Watching every transaction, looking for transactions of interest, is quite difficult. (See my article, <a href=https://medium.com/@tjayrush/the-trace-data-problem-d16b2e84fe40>The Trace Data Problem</a> for some context.)</p><p>If one wishes to be truly anal retentive (and for some reason, I do, I have no idea why), one must replay every trace (traces are nearly identical to internal transactions). In order to know that an unknown smart contract granted your account ownership of something, you have to be constantly vigilant.</p><p>It’s kind of ridiculous. I know!</p><p>Before this post runs into an infinite length, I’ll move on to the final word…</p><h4 id=decentralization>Decentralization<a href=#decentralization class=anchor aria-hidden=true>#</a></h4><p>Getting full and accurate account-specific list of transactions (and therefore token balances) from Ethereum is hard. It’s also slow. It is so slow, in fact, that it’s nearly unusable. One simply cannot replay the entire chain every time one wishes to account for a different address. There are some solutions, but none of them good.</p><p>The two most obvious solutions are: (1) make a duplicate copy of the blockchain data including all traces and build a giant database index, or (2) keep the data on the node, do not duplicate it, and figure out some way to make scanning the chain palatable. (This is what TrueBlocks does. It’s not as fast as a database index, but it’s faster than a raw scan of the entire chain, and it’s tremendously smaller than duplicating the data and creating an index.)</p><p>If one chooses the first path, one will almost certainly be forced to use some sort of gigantic cloud computer. The index alone will be many gigabytes. And it only gets bigger over time (can you say sharding?). Worse, you have to store duplicate data, and furthermore, 99% of the data you’re storing will never be used. You’re accounting for specific accounts, not the entire chain. Most likely, your customers are only interested in the data from their accounts.</p><p>If that’s not bad enough, as soon as sharding happens the “duplicate copy of the blockchain” solution will be shit out of luck. If the data size is <code>X</code> prior to sharding, it will be <code>100 * X</code> after sharding. The only viable solution if one chooses this first path will be to centralize the data and try to sell it (either directly through an API or through advertising).</p><p>Web 2.0 is dead. Long live Web 2.0. I only have to present EtherScan as my first exhibit to support this claim.</p><p>If, instead, one chooses the second path, and tries to make accessing the node-stored data faster, so that your solution remains decentralized, you quickly realize that the code <em>literally wants</em> to be open sourced. If you’re going to keep your code closed source, why not go all the way and centralize? That path is far easier and delivers the data far faster.</p><h4 id=im-out-ofwords>I’m out of Words<a href=#im-out-ofwords class=anchor aria-hidden=true>#</a></h4><p>I’m hungry, and I’ve nearly run out of words, so I’ll end with a final thought. Developers are left with a conundrum: either decentralize and be forced to open source your code or centralize it thereby eliminating the reason we all got into this thing to being with. This, I think, is why there’s currently no viable solution to the problem. There is no appealing path forward.</p><p>I’ve now officially run out of words. If you’ve made it this far, I guess you’re happy about that. I’ll say three more words…</p><h4 id=support-mywork>Support My Work<a href=#support-mywork class=anchor aria-hidden=true>#</a></h4><p>We’re interested in your thoughts. Please clap for us and post your comments below. Consider supporting our work. Send us a small (or large) contribution to 0xf503017d7baf7fbc0fff7492b751025c6a78179b.</p><p><strong>Thomas Jay Rush</strong> owns the software company TrueBlocks whose primary project is also called TrueBlocks, a collection of software libraries and applications enabling real-time, per-block smart contract monitoring and analytics to the Ethereum blockchain. Contact him through <a href=http://trueblocks.io>the website</a>.</p><p class=edit-page><a href=https://github.com/TrueBlocks/trueblocks-docs/blob/master/content/blog/2018/024-How-Many-ERC20-Tokens-Do-You-Have.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=/blog/mantras-for-decentralized-open-data/><div class="card my-1"><div class="card-body py-2">&larr; Mantras for Decentralized Open Data</div></div></a><a class=ms-auto href=/blog/the-trace-data-problem/><div class="card my-1"><div class="card-body py-2">The Trace Data Problem &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=https://github.com/TrueBlocks/trueblocks-docs>Improve docs</a></li><li class=list-inline-item><a href=/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script src=/js/highlight.min.39c8701213290bff3f62f8bd4a85d5a89866c0e28d00395817ab598ba2b45df2cb63eb9afb36d0b00e8f6665d8baf67a2feb26a04839b46dfb9b18ed5bcebd44.js integrity="sha512-OchwEhMpC/8/Yvi9SoXVqJhmwOKNADlYF6tZi6K0XfLLY+ua+zbQsA6PZmXYuvZ6L+smoEg5tG37mxjtW869RA==" crossorigin=anonymous defer></script>
<script src=/main.min.faf5ce2fa16540fed2aa52654dcbc4d344816d8672fc99d99304faa64ddbac891a7d0e3e47633606fcdcd9fa6294254d76b3e9bfe4b3b55ef761780ee819898a.js integrity="sha512-+vXOL6FlQP7SqlJlTcvE00SBbYZy/JnZkwT6pk3brIkafQ4+R2M2Bvzc2fpilCVNdrPpv+SztV73YXgO6BmJig==" crossorigin=anonymous defer></script>
<script src=/index.min.ecf5abb7b18239119e9954b1777e59b327a280d0e505d51d9fca8fa883add071e58656a001826cbba414ac14219532f9b3ff8d4a499471f921c4e9709df02bf5.js integrity="sha512-7PWrt7GCORGemVSxd35ZsyeigNDlBdUdn8qPqIOt0HHlhlagAYJsu6QUrBQhlTL5s/+NSkmUcfkhxOlwnfAr9Q==" crossorigin=anonymous defer></script></body></html>