<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.cc5491f88aca8cd815468b654859fb71bcbece02e7414cdca0957612c03f3f3015203de03edf6003b6088ad2e0bda584a197b832a19dfa35d9febb0afeed261f.css integrity="sha512-zFSR+IrKjNgVRotlSFn7cby+zgLnQUzcoJV2EsA/PzAVID3gPt9gA7YIitLgvaWEoZe4MqGd+jXZ/rsK/u0mHw==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Building an Ethereum Account Scraper with TrueBlocks - TrueBlocks</title><meta name=description content="Ethereum as it was meant to be: local-first, P2P, and accurate queries to all the data you’ll ever need."><link rel=canonical href=/blog/building-an-ethereum-account-scraper-with-trueblocks/><meta name=twitter:card content="https://trueblocks.io/trueblocks.png"><meta name=twitter:image content="https://trueblocks.io/trueblocks.png"><meta name=twitter:title content="Building an Ethereum Account Scraper with TrueBlocks"><meta name=twitter:description content="When I first heard of Ethereum, I thought to myself “Excellent! I no longer have to keep track of my spending. Everything will be automated.”
Can you say “misconception”?
Not only is keeping track of Ethereum spending way more difficult than it should be, it’s actually so difficult that I stopped spending ether all together about two years ago. (The price of ether had a lot to do with it as well."><meta name=twitter:site content="@TrueBlocks"><meta name=twitter:creator content="@TrueBlocks"><meta property="og:title" content="Building an Ethereum Account Scraper with TrueBlocks"><meta property="og:description" content="When I first heard of Ethereum, I thought to myself “Excellent! I no longer have to keep track of my spending. Everything will be automated.”
Can you say “misconception”?
Not only is keeping track of Ethereum spending way more difficult than it should be, it’s actually so difficult that I stopped spending ether all together about two years ago. (The price of ether had a lot to do with it as well."><meta property="og:type" content="article"><meta property="og:url" content="/blog/building-an-ethereum-account-scraper-with-trueblocks/"><meta property="og:image" content="https://trueblocks.io/trueblocks.png"><meta property="article:published_time" content="2018-07-06T20:21:50+00:00"><meta property="article:modified_time" content="2023-01-08T17:12:52-05:00"><meta property="og:site_name" content="TrueBlocks"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"\/blog\/building-an-ethereum-account-scraper-with-trueblocks\/"},"headline":"Building an Ethereum Account Scraper with TrueBlocks","image":[],"datePublished":"2018-07-06T20:21:50CET","dateModified":"2023-01-08T17:12:52CET","author":{"@type":"Organization","name":"TrueBlocks"},"publisher":{"@type":"Organization","name":"TrueBlocks","logo":{"@type":"ImageObject","url":"\/logo-doks.png"}},"description":""}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"\/"},{"@type":"ListItem","position":2,"name":"Blogbuilding an Ethereum Account Scraper With Trueblocks","item":"\/blogbuilding-an-ethereum-account-scraper-with-trueblocks\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="blog single"><div class="header-bar fixed-top"></div><script>(localStorage.getItem("theme")==="dark"||localStorage.getItem("theme")===null)&&document.body.classList.add("dark")</script><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container-fluid><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label>
<a class="navbar-brand order-1 order-md-0 me-auto" href=/>TrueBlocks</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/trueblocks><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://discord.com/invite/kAFcZH2x7K><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="simple icon-discord"><path d="M20.317 4.3698a19.7913 19.7913.0 00-4.8851-1.5152.0741.0741.0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868.0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077.0 00-.0785-.037 19.7363 19.7363.0 00-4.8852 1.515.0699.0699.0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824.0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777.0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076.0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077.0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743.0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614.0a.0739.0739.0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077.0 01-.0066.1276 12.2986 12.2986.0 01-1.873.8914.0766.0766.0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076.0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077.0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061.0 00-.0312-.0286zM8.02 15.3312c-1.1825.0-2.1569-1.0857-2.1569-2.419.0-1.3332.9555-2.4189 2.157-2.4189 1.2108.0 2.1757 1.0952 2.1568 2.419.0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748.0c-1.1825.0-2.1569-1.0857-2.1569-2.419.0-1.3332.9554-2.4189 2.1569-2.4189 1.2108.0 2.1757 1.0952 2.1568 2.419.0 1.3332-.946 2.4189-2.1568 2.4189z"/></svg><span class="ms-2 visually-hidden">Discord</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/trueblocks/trueblocks-core><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li><li class=nav-item><a class=nav-link href=/api>API<span class="ms-2 visually-hidden">API</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=/docs/>Introduction</a></li><li class=nav-item><a class=nav-link href=/chifra/introduction>Chifra</a></li><li class=nav-item><a class=nav-link href=/data-model/intro>Data Model</a></li><li class=nav-item><a class=nav-link href=/explorer/introduction>Explorer</a></li><li class=nav-item><a class=nav-link href=/sdks/introduction>SDKs</a></li><li class="nav-item active"><a class=nav-link href=/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=/papers/>Papers</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-4M60J4ZGSQ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4M60J4ZGSQ",{anonymize_ip:!1})}</script></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Categories</h3><ul class=list-unstyled><li><a href=/tags/ethereum>ethereum</a> (28)</li><li><a href=/tags/trueblocks>trueblocks</a> (20)</li><li><a href=/tags/community>community</a> (6)</li><li><a href=/tags/tutorials>tutorials</a> (5)</li><li><a href=/tags/faq>faq</a> (1)</li><li><a href=/tags/trueblocks/>trueblocks</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Building an Ethereum Account Scraper with TrueBlocks</h1><div class=date><small><em>Published on: </em>Jul 6, 2018
<em>Last edited: </em>Jan 8, 2023</small><br></p></div><p class=lead>First pass instructions</p><p>When I first heard of Ethereum, I thought to myself <em>“Excellent! I no longer have to keep track of my spending. Everything will be automated.”</em></p><blockquote><p><strong><em>Can you say “misconception”?</em></strong></p></blockquote><p>Not only is keeping track of Ethereum spending <em>way</em> more difficult than it should be, it’s actually so difficult that I stopped spending ether all together about two years ago. (The price of ether had a lot to do with it as well.)</p><p><em>“Why</em>,” I’ve been asking myself every since, “<em>is it so hard to keep track of my accounts? Why isn’t there an RPC command</em> <code>_eth_getAccountTransactions_</code><em>?”</em></p><p>I’ve been working on this shortcoming ever since. I’m glad to say that, as the latest version of TrueBlocks gets us a long way towards that goal.</p><p>In this post, I will show you how to build an Ethereum account scraper. An <em>account scraper</em> is different than a <em>blockchain scraper</em>. (Sorry for the clickbait title.) I think of a <em>blockchain scraper</em> as a full duplicate copy of the entire blockchain stuffed into a relational database and delivered from an expensive AWS instance via an API. We’re not building that — because of the expense of that, I think it leads to centralization such as Etherscan — we’re going scrape only the parts of the chain that is of interest to ourselves. We’re going to scrape only the transactions from or to our accounts.</p><h4 id=installing-trueblocks>Installing TrueBlocks<a href=#installing-trueblocks class=anchor aria-hidden=true>#</a></h4><p>Here’s <a href=https://trueblocks.io/docs/install/install-core/>instructions for installing and building TrueBlocks</a>. I won’t go into details. If you have trouble, please contact us through our <a href=https://discord.gg/RAz6DJ6xkf>discord channel</a>. Note — TrueBlocks requires a running Parity node, and that node must be a tracing node. It works against Infura, but Infura doesn’t support tracing, so you won’t get complete results. Try it though. You’ll be able to get some data even from Infura. Assuming you’re running a local Parity node…</p><h4 id=building-an-accountscraper>Building an Account Scraper<a href=#building-an-accountscraper class=anchor aria-hidden=true>#</a></h4><p>TrueBlocks is a C++ code library to make interacting with Ethereum easier. To get started, we need to write C++’s <code>main</code> function:</p><p><img src=/blog/img/026-Building-an-Ethereum-Account-Scraper-with-TrueBlocks-001.png alt></p><p>There are a couple of things going on here. First, you must include TrueBlocks’ header file. We do this at <code>line 1</code>. Next, we forward declare a function that will be visited each time an address is encountered in a block. We make this forward declaration at <code>line 4</code>. The function must have that signature.</p><p>At <code>line 8</code>, we use the program’s first command line argument as the number of the block we wish to visit (we use block 1,001,001 in the following examples). At <code>lines 9 and 10</code>, we query the Ethereum node for the block.</p><p>When the call to <code>getBlock</code> returns, <code>block</code> has been populated with the block data from the node. The next line, <code>line 11</code>, visits all parts of the block including each transaction, each receipt, each log, and each trace. As it visits the various parts of the block, it extracts each address it finds and calls the provided function. With each call it sends the following data:</p><p><img src=/blog/img/026-Building-an-Ethereum-Account-Scraper-with-TrueBlocks-002.png alt></p><p>The first four data fields should are obvious. They represent where in the block the address was found. The fifth field, <code>reason</code>, details <em>exactly</em> where the address was found. <code>Reason</code> will take on various values which are documented in the code.</p><p>At <code>line 19</code>, we send the data to the screen which produces these results:</p><p><img src=/blog/img/026-Building-an-Ethereum-Account-Scraper-with-TrueBlocks-003.png alt></p><p>This is a list of every address in the block, its transaction position, it trace position within the transaction (if applicable) and where the address was found. (There are 15 different places where an address might appear.)</p><p>Next, we will make two changes to the code. First, we’re going to produce only a unique list of addresses (as opposed to every address encountered including dups as it currently does). Second, we will only print out addresses we’re interested in. We make the following changes to the code:</p><p><img src=/blog/img/026-Building-an-Ethereum-Account-Scraper-with-TrueBlocks-004.png alt></p><p>We changed two things in the above code. First, we changed <code>line 11</code> to use the function <code>forEveryUniqueAddress</code> instead of <code>forEveryAddress</code>. This removes duplicates and reports only on the first appearance of an address within the block. The second change we made at <code>lines 20 and 21</code>. Here, we filter on particular addresses. This produces the following output.</p><p><img src=/blog/img/026-Building-an-Ethereum-Account-Scraper-with-TrueBlocks-005.png alt></p><p>And now, I claim we’re done… but, let’s take it up a notch. Here’s the next version:</p><p><img src=/blog/img/026-Building-an-Ethereum-Account-Scraper-with-TrueBlocks-006.png alt></p><p>This takes two command line arguments: <code>startBlock</code> and <code>endBlock</code> and visits each block in the range and then visits each address in those blocks. And now, we think, you actually have a full-fledged <em>account scraper</em>. Go ahead and build you own <em>blockchain scraper</em> if you want.</p><p>Of course, you may enhance the above code to your heart’s content. Add a lot of command line options. Add some input checking. Add feature that allows you to specify a range of blocks on the command line. Add a feature that allows you to specify the address(es) you’re interested in on the command line. Keep track of the last block visited, go to sleep every loop, and keep up with the tip of the chain. Account for the transactions as you encounter them. Export to the data to your accounting software!</p><p>Check out our command line tool called <code>getBlock</code>. This tool does much of what we describe above. <code>getBlock</code> is <a href=https://github.com/TrueBlocks/trueblocks-core/blob/master/src/tools/getBlock/README.md>fully open source</a>, and you can enter a command like this:</p><blockquote><p>getBlock &ndash;addrs 5000000-5250000 | grep 0x2a65aca4d5…135398226</p></blockquote><p>which will scan the 250,000 blocks between 5,000,000 and 5,250,000 and filter out only transactions involving the given address. With such a list, you can do anything…including…wait for it….including…automate your accounting! Go out and spend!</p><h4 id=support-mywork>Support My Work<a href=#support-mywork class=anchor aria-hidden=true>#</a></h4><p>I’m interested in your thoughts. Please clap for us and post your comments below. Consider supporting our work. Send us a small (or large) contribution to 0xf503017d7baf7fbc0fff7492b751025c6a78179b.</p><p><strong>Thomas Jay Rush</strong> owns the software company TrueBlocks whose primary project is also called TrueBlocks, a collection of software libraries and applications enabling real-time, per-block smart contract monitoring and analytics to the Ethereum blockchain. Contact him through <a href=http://trueblocks.io>the website</a>.</p><p class=edit-page><a href=https://github.com/TrueBlocks/trueblocks-docs/blob/master/content/blog/2018/026-Building-an-Ethereum-Account-Scraper-with-TrueBlocks.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=/blog/a-short-take-on-decentralization/><div class="card my-1"><div class="card-body py-2">&larr; A Short Take on Decentralization</div></div></a><a class=ms-auto href=/blog/mantras-for-decentralized-open-data/><div class="card my-1"><div class="card-body py-2">Mantras for Decentralized Open Data &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=https://github.com/TrueBlocks/trueblocks-docs>Improve docs</a></li><li class=list-inline-item><a href=/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script src=/js/highlight.min.39c8701213290bff3f62f8bd4a85d5a89866c0e28d00395817ab598ba2b45df2cb63eb9afb36d0b00e8f6665d8baf67a2feb26a04839b46dfb9b18ed5bcebd44.js integrity="sha512-OchwEhMpC/8/Yvi9SoXVqJhmwOKNADlYF6tZi6K0XfLLY+ua+zbQsA6PZmXYuvZ6L+smoEg5tG37mxjtW869RA==" crossorigin=anonymous defer></script>
<script src=/main.min.faf5ce2fa16540fed2aa52654dcbc4d344816d8672fc99d99304faa64ddbac891a7d0e3e47633606fcdcd9fa6294254d76b3e9bfe4b3b55ef761780ee819898a.js integrity="sha512-+vXOL6FlQP7SqlJlTcvE00SBbYZy/JnZkwT6pk3brIkafQ4+R2M2Bvzc2fpilCVNdrPpv+SztV73YXgO6BmJig==" crossorigin=anonymous defer></script>
<script src=/index.min.ecf5abb7b18239119e9954b1777e59b327a280d0e505d51d9fca8fa883add071e58656a001826cbba414ac14219532f9b3ff8d4a499471f921c4e9709df02bf5.js integrity="sha512-7PWrt7GCORGemVSxd35ZsyeigNDlBdUdn8qPqIOt0HHlhlagAYJsu6QUrBQhlTL5s/+NSkmUcfkhxOlwnfAr9Q==" crossorigin=anonymous defer></script></body></html>